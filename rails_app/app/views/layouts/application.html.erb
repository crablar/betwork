<!DOCTYPE html>
<html>

<head>
  <title>Betwork</title>
  <%= stylesheet_link_tag    "application", media: "all", "data-turbolinks-track" => true %>
  <%= javascript_include_tag "application", "data-turbolinks-track" => true %>
  <%= csrf_meta_tags %>
</head>
<body>

<script src="http://code.highcharts.com/highcharts.js"></script>
<script src="http://code.highcharts.com/modules/exporting.js"></script>

<div id="user-widget">
  <% if current_user %>
    Welcome <strong><%= current_user.name %></strong>!
  </br>
    Balance:
    $<%= current_user.balance %>
    <%= image_tag(current_user.profile_image_url)%>
    <%= link_to "Sign out", signout_path, id: "sign_out" %>
  <% else %>
    <%= link_to "Sign in with Facebook", "/auth/facebook", id: "sign_in" %>
  <% end %>
</div>

<%= get_charts.each do |chart| %>
  <div>
    <div id="<%= chart['subjectName'] %>Chart" style="min-width: 310px; height: 400px; margin: 0 auto">
    </div>
    <button class="btn btn-bet" data-id="<%= chart['subjectName'] %>">Invest</button>
  </div>
<% end %>

<% if current_user %>
  <script>
    $(function() {
        $('.btn-bet').click(function() {
          $.ajax({
            url:  "users",
            type: 'POST',
            data: {
              subjectName: $(this).data('id'),
              userId: "<%= current_user.id %>"
            },
            dataType: 'json',
            accepts: 'json',
            success: function(data, status) {
              console.log('success');
              console.log(data);
            },
            error: function(jqXHR, status, error) {
              console.log('error');
              console.log(error);
            }
          });
        });
      });
  </script>
<% end %>

<script src="/app/assets/javascripts/samplechart.js"></script>


<%= yield %>

</body>
</html>
